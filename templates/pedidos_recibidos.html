{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/p_recibidos.css') }}">

<div class="pedido-container">
    <h2>üì• Pedidos Recibidos</h2>

    {% if pedidos %}
    <table class="tabla-pedidos">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Tipo de Producto</th>
                <th>Materiales</th>
                <th>Dise√±o</th>
                <th>Presupuesto</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for p in pedidos %}
            <tr>
                <td>{{ p.nombre_cliente }}</td>
                <td>{{ p.tipo_producto }}</td>
                <td>{{ p.materiales }}</td>
                <td>{{ p.diseno }}</td>
                <td>${{ p.presupuesto }}</td>
                <td><span class="estado {{ p.estado|lower }}">{{ p.estado }}</span></td>
                <td>
                    <form action="{{ url_for('actualizar_pedido_personalizado', id_pedido=p.id_pedido_personalizado) }}" method="POST">
                        
                        <!-- Bot√≥n aceptar con fecha -->
                        <div class="form-group">
                            <label for="fecha_entrega">üìÖ Fecha estimada de entrega</label>
                            <input type="date" name="fecha_entrega" required min="{{ fecha_hoy }}">
                        </div>
                        <button type="submit" name="estado" value="Aceptado">Aceptar</button>

                        <!-- Bot√≥n rechazar con modal -->
                        <button type="button" onclick="abrirModal({{ p.id_pedido_personalizado }})">Rechazar</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No tienes pedidos recibidos a√∫n.</p>
    {% endif %}
</div>

<!-- Modal Rechazo -->
<div id="modal-rechazo" class="modal">
    <div class="modal-content">
        <h3>‚ùå Rechazar Pedido</h3>
        <form id="form-rechazo" method="POST">
            <textarea name="comentario_rechazo" placeholder="Explica por qu√© rechazas este pedido..." required></textarea>
            <input type="hidden" name="estado" value="Rechazado">
            <button type="submit" class="btn-confirmar">Enviar</button>
            <button type="button" class="btn-cancelar" onclick="cerrarModal()">Cancelar</button>
        </form>
    </div>
</div>

<script>
    function abrirModal(idPedido) {
        const modal = document.getElementById("modal-rechazo");
        const form = document.getElementById("form-rechazo");
        form.action = "/pedido_personalizado/" + idPedido + "/rechazar";
        modal.style.display = "block";
    }
    function cerrarModal() {
        document.getElementById("modal-rechazo").style.display = "none";
    }
</script>
{% endblock %}
